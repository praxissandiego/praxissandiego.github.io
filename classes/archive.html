<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Praxis CU Class Archive - Praxis Community University</title>
    <meta name="description" content="Archive of past classes offered at Praxis Community University.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://praxissandiego.com/classes/archive.html">
    <meta property="og:title" content="Praxis CU Class Archive - Praxis Community University">
    <meta property="og:description" content="Archive of past classes offered at Praxis Community University.">
    <meta property="og:image" content="https://praxissandiego.com/images/preview.jpg">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Praxis CU Class Archive - Praxis Community University">
    <meta name="twitter:description" content="Archive of past classes offered at Praxis Community University.">
    <meta name="twitter:image" content="https://praxissandiego.com/images/preview.jpg">
    <link rel="icon" href="/favicon.ico">
    <link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../css/main.css">
</head>
<body>
    <canvas id="backgroundCanvas"></canvas>
    <button id="animationToggle" aria-label="Toggle background animation">⏻︎</button>

    <div class="container">
        <header>
            <div class="header-content">
                <h1>Praxis CU Class Archive</h1>
                <a href="../university.html" class="back-link">← to Community University</a>
            </div>
        </header>

        <div class="description">
            <p>
                Browse all past classes offered at Praxis Community University! Classes are organized by term and can be searched and sorted using the controls below.
            </p>
        </div>

        <div class="controls">
            <div class="search-box">
                <input type="text" id="searchInput" placeholder="Search by title, instructor, or keyword...">
            </div>
        </div>

        <div class="table-wrapper">
            <table id="archiveTable" class="table-4col">
                <thead>
                    <tr>
                        <th data-column="0">Class & Description<br>(Click for Info)</th>
                        <th data-column="1">Instructor(s)</th>
                        <th data-column="2">Days, Times, and Dates</th>
                        <th data-column="3">Term</th>
                    </tr>
                </thead>
                <tbody id="archiveTableBody">
                    <!-- Data loaded dynamically -->
                </tbody>
            </table>
        </div>

        <div class="stats">
            <span id="visibleCount">0</span> of <span id="totalCount">0</span> classes shown
        </div>
    </div>

    <script src="../js/table-utils.js"></script>
    <script src="../js/background-animation-smallworld.js"></script>
    <script src="../js/menu.js"></script>
    <script>
        // Configuration: List all terms to load
        // Add new terms here as they are created
        const TERMS = [
            {
                name: 'Fall 2025',
                path: '/data/terms/fall2025.json',
                linkPrefix: '/../'
            }
            // Add future terms like:
            // { name: 'Winter 2026', path: '/data/terms/winter2026.json', linkPrefix: '/classes/winter2026/' }
        ];

        // Load all terms and populate the archive
        async function loadArchive() {
            try {
                // Set archive page flag for table-utils.js
                isArchivePage = true;

                allData = await loadAllTerms(TERMS);
                filteredData = [...allData];

                // Update total count
                const totalCount = document.getElementById('totalCount');
                if (totalCount) {
                    totalCount.textContent = allData.length;
                }

                // Populate table with term column
                populateArchiveTable(allData);

                // Initialize controls
                initializeControls();

            } catch (error) {
                console.error('Error loading archive:', error);
                const tbody = document.getElementById('archiveTableBody');
                if (tbody) {
                    tbody.innerHTML = '<tr><td colspan="4">Unable to load archive data. Please try again later.</td></tr>';
                }
            }
        }

        // Override filterTable for archive-specific behavior
        function filterTable() {
            const searchInput = document.getElementById('searchInput');
            const searchTerm = searchInput ? searchInput.value.toLowerCase() : '';

            filteredData = allData.filter(item => {
                const matchesSearch =
                    item.name.toLowerCase().includes(searchTerm) ||
                    item.description.toLowerCase().includes(searchTerm) ||
                    item.instructor.toLowerCase().includes(searchTerm) ||
                    item.when.toLowerCase().includes(searchTerm) ||
                    item.term.toLowerCase().includes(searchTerm);

                return matchesSearch;
            });

            populateArchiveTable(filteredData);
        }

        // Override sortData for archive-specific behavior (use term instead of where)
        function sortData(column, ascending) {
            const fields = ['name', 'instructor', 'whenSort1', 'term'];

            let field = fields[column];

            filteredData.sort((a, b) => {
                // Use whenSort1 for sorting column 2, otherwise use the field directly
                let aVal = field === 'whenSort1' ? (a[field] || a.when) : a[field];
                let bVal = field === 'whenSort1' ? (b[field] || b.when) : b[field];

                // Convert to lowercase for string comparison
                if (typeof aVal === 'string') aVal = aVal.toLowerCase();
                if (typeof bVal === 'string') bVal = bVal.toLowerCase();

                if (ascending) {
                    return aVal > bVal ? 1 : -1;
                } else {
                    return aVal < bVal ? 1 : -1;
                }
            });

            populateArchiveTable(filteredData);
        }

        // Load archive when page loads
        document.addEventListener('DOMContentLoaded', loadArchive);
    </script>
</body>
</html>
